<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App de Média de Dias</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #fileInput, #daySelect, #calculateBtn {
            margin: 10px 0;
        }
        #chartContainer {
            margin-top: 20px;
        }
        #result {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>App de Média de Dias</h1>
    <p>Carregue um arquivo CSV com colunas "data" (formato YYYY-MM-DD) e "valor". Selecione os dias desejados e clique em "Calcular Média".</p>
    <input type="file" id="fileInput" accept=".csv">
    <select id="daySelect" multiple style="width: 100%; height: 150px;"></select>
    <button id="calculateBtn" disabled>Calcular Média</button>
    <div id="result"></div>
    <div id="chartContainer">
        <canvas id="averageChart"></canvas>
    </div>

    <script>
        let data = [];
        let chart = null;

        document.getElementById('fileInput').addEventListener('change', handleFile);
        document.getElementById('calculateBtn').addEventListener('click', calculateAverage);

        function handleFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                parseCSV(text);
            };
            reader.readAsText(file);
        }

        function parseCSV(text) {
            data = [];
            const lines = text.split('\n').filter(line => line.trim());
            const headers = lines[0].split(',').map(h => h.trim());

            if (!headers.includes('data') || !headers.includes('valor')) {
                alert('O CSV deve conter as colunas "data" e "valor"');
                return;
            }

            for (let i = 1; i < lines.length; i++) {
                const [date, value] = lines[i].split(',').map(item => item.trim());
                if (date && value && !isNaN(value)) {
                    data.push({ date, value: parseFloat(value) });
                }
            }

            populateDaySelect();
            document.getElementById('calculateBtn').disabled = false;
        }

        function populateDaySelect() {
            const daySelect = document.getElementById('daySelect');
            daySelect.innerHTML = '';
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.date;
                option.text = item.date;
                daySelect.appendChild(option);
            });
        }

        function calculateAverage() {
            const selectedDays = Array.from(document.getElementById('daySelect').selectedOptions).map(opt => opt.value);
            if (selectedDays.length === 0) {
                alert('Selecione pelo menos um dia');
                return;
            }

            const selectedData = data.filter(item => selectedDays.includes(item.date));
            const sum = selectedData.reduce((acc, item) => acc + item.value, 0);
            const average = sum / selectedData.length;

            document.getElementById('result').textContent = Média dos valores selecionados: ${average.toFixed(2)};

            updateChart(selectedData, average);
        }

        function updateChart(selectedData, average) {
            const ctx = document.getElementById('averageChart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: selectedData.map(item => item.date),
                    datasets: [{
                        label: 'Valores',
                        data: selectedData.map(item => item.value),
                        backgroundColor: 'rgba(75, 192 possibilidade de fazer upload de fotos, mas como o foco do pedido é calcular médias a partir de arquivos com dados numéricos, optei por suportar apenas arquivos CSV. O CSV deve ter duas colunas: "data" (no formato YYYY-MM-DD) e "valor" (número).
